// Initialization when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  initFloatingHearts();
  initTimeline();
  initQuiz();
  initLoveMessages();
  initMusic();
  
  // Add initial animation classes
  document.querySelectorAll('.animate__animated').forEach(element => {
    element.classList.add('animate__animated');
  });
});

// Floating Hearts Background
function initFloatingHearts() {
  const heartsContainer = document.getElementById('hearts-container');
  
  // Create initial hearts
  for (let i = 0; i < 20; i++) {
    createHeart();
  }
  
  // Create a new heart every 2 seconds
  setInterval(createHeart, 2000);
  
  function createHeart() {
    const heart = document.createElement('div');
    heart.classList.add('floating-heart');
    heart.innerHTML = '♥';
    heart.style.left = `${Math.random() * 100}%`;
    heart.style.opacity = Math.random() * 0.5 + 0.3;
    heart.style.fontSize = `${Math.random() * 15 + 10}px`;
    heart.style.animationDuration = `${Math.random() * 10 + 5}s`;
    
    heartsContainer.appendChild(heart);
    
    // Remove heart after animation completes
    setTimeout(() => {
      heart.remove();
    }, 15000);
  }
  
  // Mouse trail hearts effect – disabled on mobile
  if (!/Mobi|Android/i.test(navigator.userAgent)) {
    document.addEventListener("mousemove", function(e) {
      if (Math.random() > 0.9) { // Only show hearts occasionally for better performance
        let heart = document.createElement("div");
        heart.className = "heart";
        heart.innerHTML = "♥";
        heart.style.left = (e.pageX - 7.5) + "px";
        heart.style.top = (e.pageY - 7.5) + "px";
        heart.style.animation = "fadeOut 2s forwards";
        heart.style.position = "absolute";
        heart.style.color = "rgba(255, 79, 129, 0.7)";
        heart.style.fontSize = `${Math.random() * 10 + 15}px`;
        heart.style.pointerEvents = "none";
        document.body.appendChild(heart);
        
        setTimeout(() => heart.remove(), 2000);
      }
    });
  }
}

// Open envelope animation
function openEnvelope() {
  document.querySelector('.envelope').classList.add('open');
}

// Initialize music player
function initMusic() {
  const music = document.getElementById('bg-music');
  const musicToggle = document.getElementById('music-toggle');
  const musicLabel = document.querySelector('.music-label');
  let isPlaying = false;
  
  musicToggle.addEventListener('click', function() {
    if (isPlaying) {
      music.pause();
      musicLabel.textContent = 'Play Music';
      musicToggle.classList.remove('playing');
    } else {
      music.play().catch(() => {
        console.log('Audio playback was prevented. User interaction required.');
      });
      musicLabel.textContent = 'Pause Music';
      musicToggle.classList.add('playing');
    }
    
    isPlaying = !isPlaying;
  });
  
  // Auto-play music on first interaction with the page
  document.body.addEventListener('click', function musicHandler() {
    if (!isPlaying) {
      music.play().then(() => {
        isPlaying = true;
        musicLabel.textContent = 'Pause Music';
        musicToggle.classList.add('playing');
      }).catch(() => {
        console.log('Audio playback was prevented. User interaction required.');
      });
    }
    
    // Remove this handler after first click
    document.body.removeEventListener('click', musicHandler);
  }, { once: true });
}

// Initialize timeline functionality
function initTimeline() {
  const eventImage = document.getElementById("event-image");
  const eventBlocks = document.querySelectorAll(".event");
  
  eventBlocks.forEach(event => {
    event.addEventListener("click", () => {
      // Remove active class from all events
      eventBlocks.forEach(e => e.classList.remove('active'));
      
      // Add active class to clicked event
      event.classList.add('active');
      
      // Change the image
      const imgSrc = event.getAttribute("data-img");
      if (imgSrc) {
        eventImage.style.opacity = 0;
        
        setTimeout(() => {
          eventImage.src = imgSrc;
          eventImage.style.opacity = 1;
        }, 300);
      }
    });
  });
}

// Initialize quiz functionality
function initQuiz() {
  const optionButtons = document.querySelectorAll('.option-btn');
  const quizQuestion = document.getElementById('quiz-question');
  const quizResult = document.getElementById('quiz-result');
  
  optionButtons.forEach(button => {
    button.addEventListener('click', () => {
      // Hide question and show result with animation
      quizQuestion.classList.add('animate__animated', 'animate__fadeOut');
      
      setTimeout(() => {
        quizQuestion.classList.add('hidden');
        quizResult.classList.remove('hidden');
        quizResult.classList.add('animate__animated', 'animate__fadeIn');
        
        // Create heart shower animation
        createHeartShower();
      }, 500);
    });
  });
  
  function createHeartShower() {
    const hearts = 50;
    const container = document.querySelector('.quiz-container');
    
    for (let i = 0; i < hearts; i++) {
      const heart = document.createElement('div');
      heart.innerHTML = '♥';
      heart.style.position = 'absolute';
      heart.style.left = Math.random() * 100 + '%';
      heart.style.top = '0';
      heart.style.fontSize = Math.random() * 20 + 10 + 'px';
      heart.style.color = 'rgba(255, 79, 129, ' + (Math.random() * 0.7 + 0.3) + ')';
      heart.style.animation = 'fall ' + (Math.random() * 5 + 3) + 's linear forwards';
      container.appendChild(heart);
      
      setTimeout(() => heart.remove(), 8000);
    }
  }
}

// Initialize love message generator
function initLoveMessages() {
  const messages = [
    "Every day with you is a new adventure I cherish.",
    "Your smile is my favorite view in the whole world.",
    "I fall in love with you a little more each day.",
    "You make my heart skip a beat, even after all this time.",
    "Together with you is my favorite place to be.",
    "You're the missing piece I never knew I needed.",
    "Your love feels like coming home after a long day.",
    "With you, ordinary moments become extraordinary memories.",
    "I love all of your little quirks that make you uniquely you.",
    "You're not just my lover, but my best friend too."
  ];
  
  const messageBtn = document.getElementById('message-btn');
  const loveMessage = document.getElementById('love-message');
  
  messageBtn.addEventListener('click', () => {
    // Hide current message with animation
    loveMessage.classList.add('animate__animated', 'animate__fadeOut');
    
    setTimeout(() => {
      // Select random message
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      
      // Update and show with new animation
      loveMessage.textContent = randomMessage;
      loveMessage.classList.remove('animate__fadeOut');
      loveMessage.classList.add('animate__fadeIn');
    }, 500);
  });
}

// Add style for falling hearts animation
const styleElement = document.createElement('style');
styleElement.textContent = `
  @keyframes fadeOut {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    100% { opacity: 0; transform: translateY(-20px) scale(1.5); }
  }
  
  @keyframes fall {
    0% { transform: translateY(-20px) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translateY(400px) rotate(360deg); opacity: 0; }
  }
`;
document.head.appendChild(styleElement);
